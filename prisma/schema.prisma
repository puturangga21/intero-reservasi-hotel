generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ENUM
enum RoomType {
  ROYAL
  EXECUTIVE
  FAMILY
  PRESEDENTIAL
}

enum RoomStatus {
  AVAILABLE
  MAINTENANCE
}

enum MaintenancePriority {
  LOW
  HIGH
  EMERGENCY
}

enum MaintenanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
  REFUNDED
  FAILED
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

// MODEL
model Account {
  id                String  @id @default(cuid())
  customer_id       String  @map("customer_id")
  employee_id       String  @map("employee_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  customer Customer @relation(fields: [customer_id], references: [customer_id], onDelete: Cascade)
  employee Employee @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Customer {
  customer_id  String   @id @default(cuid())
  fullname     String   @db.VarChar(100)
  email        String   @unique @db.VarChar(100)
  password     String   @db.VarChar(255)
  phone_number String?  @db.VarChar(20)
  img_identity String?  @db.VarChar(255)
  created_at   DateTime @default(now())

  reservation Reservation[]
  account     Account[]
}

model Employee {
  employee_id String @id @default(cuid())
  fullname    String @db.VarChar(100)
  email       String @unique @db.VarChar(100)
  password    String @db.VarChar(255)

  maintenance Maintenance[]
  account     Account[]
  refund      Refund[]
}

model Room {
  room_id         String     @id @default(cuid())
  room_number     Int        @unique @default(autoincrement())
  room_type       RoomType
  price_per_night Decimal    @db.Decimal(10, 2)
  status          RoomStatus @default(AVAILABLE)
  description     String     @db.Text

  reservation Reservation[]
  maintenance Maintenance[]
}

model RoomGallery {
  gallery_id String   @id @default(cuid())
  room_type  RoomType
  image      String[]
  created_at DateTime @default(now())

  @@index([room_type])
}

model Maintenance {
  maintenance_id    String              @id @default(cuid())
  room_id           String
  employee_id       String?
  issue_description String              @db.Text
  priority          MaintenancePriority @default(LOW)
  status            MaintenanceStatus   @default(PENDING)
  start_date        DateTime?
  end_date          DateTime?

  room     Room      @relation(fields: [room_id], references: [room_id])
  employee Employee? @relation(fields: [employee_id], references: [employee_id])
}

model Reservation {
  reservation_id String @id @default(cuid())
  customer_id    String
  room_id        String

  check_in_date  DateTime
  check_out_date DateTime
  total_price    Decimal           @db.Decimal(10, 2)
  total_nights   Int
  status         ReservationStatus @default(PENDING)
  created_at     DateTime          @default(now())

  customer Customer @relation(fields: [customer_id], references: [customer_id])
  room     Room     @relation(fields: [room_id], references: [room_id])

  transaction Transaction[]
  refund      Refund?
}

model Transaction {
  transaction_id String             @id @default(cuid())
  reservation_id String
  amount         Decimal?           @db.Decimal(10, 2)
  payment_method String?            @db.VarChar(50)
  payment_date   DateTime?          @default(now())
  status         TransactionStatus? @default(PENDING)
  code           String?            @unique @db.Text
  invoice_url    String?            @db.Text

  reservation Reservation @relation(fields: [reservation_id], references: [reservation_id])
}

model Refund {
  refund_id      String   @id @default(cuid())
  reservation_id String   @unique
  employee_id    String
  amount         Decimal  @db.Decimal(10, 2)
  reason         String   @db.Text
  refund_date    DateTime @default(now())

  reservation Reservation @relation(fields: [reservation_id], references: [reservation_id])
  employee    Employee    @relation(fields: [employee_id], references: [employee_id])
}
