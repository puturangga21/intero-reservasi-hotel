generator client {
  provider = "prisma-client-js"
  output   = "../prisma/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ENUM
enum Role {
  ADMIN
  RECEPTIONIST
  CLEANING
  TECHNICIAN
}

enum RoomType {
  SINGLE
  DOUBLE
  SUITE
}

enum RoomStatus {
  AVAILABLE
  MAINTENANCE
}

enum MaintenancePriority {
  LOW
  HIGH
  EMERGENCY
}

enum MaintenanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
  NO_SHOW
  REFUNDED
}

enum TransactionStatus {
  PENDING
  SUCCESS
  FAILED
}

// MODEL
model Customer {
  customer_id  String   @id @default(cuid())
  fullname     String   @db.VarChar(100)
  email        String   @unique @db.VarChar(100)
  password     String   @db.VarChar(255)
  phone_number String   @db.VarChar(20)
  img_identity String   @db.VarChar(255)
  created_at   DateTime @default(now())

  reservation Reservation[]
}

model Employee {
  employee_id String @id @default(cuid())
  fullname    String @db.VarChar(100)
  email       String @unique @db.VarChar(100)
  password    String @db.VarChar(255)
  role        Role   @default(RECEPTIONIST)

  reservation Reservation[]
  maintenance Maintenance[]
}

model Room {
  room_id         String     @id @default(cuid())
  room_number     String     @unique @db.VarChar(20)
  type            RoomType
  price_per_night Decimal    @db.Decimal(10, 2)
  status          RoomStatus @default(AVAILABLE)
  description     String     @db.Text
  image           String[]

  reservation Reservation[]
  maintenance Maintenance[]
}

model Maintenance {
  maintenance_id    String              @id @default(cuid())
  room_id           String
  employee_id       String?
  issue_description String              @db.Text
  priority          MaintenancePriority @default(LOW)
  status            MaintenanceStatus   @default(PENDING)
  start_date        DateTime?
  end_date          DateTime?

  room     Room      @relation(fields: [room_id], references: [room_id])
  employee Employee? @relation(fields: [employee_id], references: [employee_id])
}

model Reservation {
  reservation_id String            @id @default(cuid())
  customer_id    String
  room_id        String
  employee_id    String?
  check_in_date  DateTime
  check_out_date DateTime
  total_price    Decimal           @db.Decimal(10, 2)
  status         ReservationStatus @default(PENDING)
  created_at     DateTime          @default(now())

  customer Customer  @relation(fields: [customer_id], references: [customer_id])
  room     Room      @relation(fields: [room_id], references: [room_id])
  employee Employee? @relation(fields: [employee_id], references: [employee_id])

  transaction Transaction[]
}

model Transaction {
  transaction_id String            @id @default(cuid())
  reservation_id String
  amount         Decimal           @db.Decimal(10, 2)
  payment_method String            @db.VarChar(50)
  payment_date   DateTime          @default(now())
  status         TransactionStatus @default(PENDING)
  code           String            @unique @db.Text
  invoice_url    String            @db.Text

  reservation Reservation @relation(fields: [reservation_id], references: [reservation_id])
}
